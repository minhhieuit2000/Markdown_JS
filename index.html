<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Javascript</title>
</head>
<style>
    * {
        font-family: 'roboto', sans-serif;
    }

    #myform {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .form__input {
        border: 1px solid;
        padding: 20px 30px;
    }

    .form-label {
        display: inline-block;
        margin: 5px 0;
    }

    input {
        border: 1px solid;
        display: block;
        width: 90%;
        padding: 10px;
        border-radius: 5px;
    }

    .form__input-form {
        margin-bottom: 15px;
    }

    .form__input--submit {
        display: block;
    }

    input[type=number]::-webkit-inner-spin-button {
        -webkit-appearance: none;
    }
</style>

<body>
    <h1>JAVASCRIPT</h1>
    <form method="post" action="" id="myform" onsubmit="BMI()">
        <div class="form__input">
            <h1>Tính chỉ số BMI của bạn</h1>
            <div class="form__input-form form__input--name">
                <label for="" class="form-label">Họ Tên:</label>
                <input id="name" type="text" required maxlength="65" name="text" placeholder="Nhập tên của bạn">
                <span class="form-message"></span>
            </div>
            <div class="form__input-form form__input--weight">
                <label for="weight" class="form-label"> Cân nặng (kg):</label>
                <input id="weight" type="number" required maxlength="3" name="text" placeholder="Nhập cân nặng">
                <span class="form-message"></span>
            </div>
            <div class="form__input-form form__input--height">
                <label for="height" class="form-label">Chiều cao (cm):</label>
                <input id="height" type="number" required maxlength="3" name="text" placeholder="Nhập chiều cao">
                <span class="form-message"></span>
            </div>
            <div class="form__input-form form__input--submit">
                <button id="btn" type="submit" onsubmit="BMI()">Submit</button>
                <button type="button" onclick="resetForm()">Reset</button>
            </div>
            <br>
            Kết quả BMI của bạn là: <span id="result"></span><br><br>
            Thông tin: <br>
            <span id="test"></span>
        </div>
    </form>
    <!-- <script src="./main.js"></script> -->
    <script>
        console.log('1', document.getElementById("result"))
        document.addEventListener("DOMContentLoaded", () => {
            let localBMI = localStorage.getItem('localBMI'); // Tìm trong localStorage có key nào là BMI không
            localBMI = JSON.parse(localBMI); // giải mã localBMI ra
            if (localBMI == null) {
                localBMI = [];
            }
            let html = '';
            for (let i = 0; i < localBMI.length; i++) {
                html += '<p> Tên: ' + localBMI[i].name + ' ' + '<br>' + 'BMI:' + localBMI[i].BMI + '<br>' + ' ' + 'Kết quả:' + localBMI[i].status + '</p>'
            }
            document.getElementById("test").innerHTML = html;
            // bt1: lưu array
            localStorage.setItem('localBMI', JSON.stringify(localBMI));

        });

    </script>
    <script>
        let localBMI = localStorage.getItem('localBMI'); // Tìm trong localStorage có key nào là BMI không
        localBMI = JSON.parse(localBMI); // giải mã localBMI ra
        console.log(localBMI);

        let arrayBMI = []
        if (localBMI) {
            arrayBMI = localBMI;
            let html = ''
            for (let i = 0; i < arrayBMI.length; i++) {
                html += '<p> Tên: ' + arrayBMI[i].name + ' ' + '<br>' + 'BMI:' + arrayBMI[i].BMI + '<br>' + ' ' + 'Kết quả:' + arrayBMI[i].status + '</p>'
            };

            // bt1: lưu array
            localStorage.setItem('localBMI', JSON.stringify(arrayBMI));
        }

        function BMI() {

            let n = String(document.getElementById("name").value);
            let a = Number(document.getElementById("weight").value);
            let b = Number(document.getElementById("height").value);

            b = b / 100;
            let kq;
            let BMI = a / Math.pow(b, 2);
            if (BMI < 18.5) {
                console.log('Nhẹ cân (CED) ' + Math.round(BMI * 100) / 100);
                kq = 'Nhẹ cân (CED) ';
            } else if (BMI >= 18.5 && BMI <= 22.9) {
                console.log('Tình trạng dinh dưỡng bình thường ' + Math.round(BMI * 100) / 100);
                kq = 'Tình trạng dinh dưỡng bình thường ';
            } else if (BMI == 23.0) {
                console.log('Thừa cân ' + Math.round(BMI * 100) / 100);
                kq = 'Thừa cân ';
            } else if (BMI >= 23.0 && BMI <= 24.9) {
                console.log('Tiền béo phì ' + Math.round(BMI * 100) / 100);
                kq = 'Tiền béo phì ';
            } else if (BMI >= 25.0 && BMI <= 29.9) {
                console.log('Béo phì độ I ' + Math.round(BMI * 100) / 100);
                kq = 'Béo phì độ I ';
            } else if (BMI >= 30.0) {
                console.log('Béo phì độ II ' + Math.round(BMI * 100) / 100);
                kq = 'Béo phì độ II ';
            }
            document.getElementById("result").innerHTML = Math.round(BMI * 100) / 100;
            let data = {
                name: n,
                BMI: Math.round(BMI * 100) / 100,
                status: kq
            };
            console.log(data);
            // console.log(data.name)
            arrayBMI.push(data);
            // console.log(arrayBMI);
            let html = ''
            for (let i = 0; i < arrayBMI.length; i++) {
                html += '<p> Tên: ' + arrayBMI[i].name + ' ' + '<br>' + 'BMI:' + arrayBMI[i].BMI + '<br>' + ' ' + 'Kết quả:' + arrayBMI[i].status + '</p>'
            }

            // bt1: lưu array
            localStorage.setItem('localBMI', JSON.stringify(arrayBMI)); // stringify mã hoá dữ liệu


            // bt2: lưu data
            // localStorage.setItem("name", n);
            // localStorage.setItem("weight", a);
            // localStorage.setItem("height",  b * 100);


            // for(let key in data){
            document.getElementById("test").innerHTML = html;
            // }       

            // Chặn hành vi load form
            // document.getElementById("#myform").addEventListener("click", function (event) {
            //     event.preventDefault()
            //     // checkInputs();
            // });

        }
        // function checkInputs() {
        // let n = document.getElementById("name").value;
        // let a = document.getElementById("weight").value;
        // let b = document.getElementById("height").value;

        // if (n == "") {
        //     alert("Vui lòng nhập tên");
        //     return false;
        // }
        // if (a == "") {
        //     alert("Vui lòng nhập cân nặng");
        //     return false;
        // }
        // if (b == "") {
        //     alert("Vui lòng nhập chiều cao");
        //     return false;
        // }
        // alert("ok")

        // return true;
        //  }



        // Code để ngoài để dùng để xử lý tất cả phần tử 
        // khai báo biến btnClear truyền vào phần tử selector id nút btn có phương thức lưu trữ nó trong biến btnClear
        // let btnClear = document.querySelector('.btn-clear');
        // khai báo inputs truyền vào selectorall lấy tất cả thẻ html có input
        // let inputs = document.querySelectorAll('input');
        // Xử lý sự kiện nghe click khi submit form, value sẽ thành 1 chuỗi trống cho mỗi phần tử input
        // btnClear.addEventListener('click', () => {
        //     inputs.forEach(input => input.value = '');
        // });
        // getElementsByTagName: Tìm đến tất cả phần tử có id là myform
        function resetForm() {
            document.getElementById('myform').reset();
        }
        // function render(){
        //     // Xuất local ra màn hình
        //     let n = localStorage.getItem("name");
        //     document.getElementById("name").value = n;
        //     let a = localStorage.getItem("weight");
        //     document.getElementById("weight").value = a;
        //     let b = localStorage.getItem("height");
        //     document.getElementById("height").value = b;
        // }
    </script>
    <!-- <script>
        function isNumberKey(number) {
            var charCode = (number.which) ? number.which : event.keyCode
            if (charCode > 31 && (charCode < 48 || charCode > 57))
                return false;

            return true;
        }

    </script> -->

</body>

</html>
